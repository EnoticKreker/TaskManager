# README

## Описание проекта

В этом проекте используется стек из нескольких сервисов, запущенных через Docker Compose:

- **PostgreSQL** — база данных для хранения данных приложения  
- **RabbitMQ** — брокер сообщений для обработки очередей  
- **API** — FastAPI приложение, которое обслуживает HTTP запросы  
- **Worker** — фоновый обработчик задач (например, для работы с очередями RabbitMQ)  

---

## Как запустить проект
1. В корне проекта есть файл `docker-compose.yml`, который описывает все сервисы.

2. Чтобы запустить все сервисы, выполните команду в терминале:

```bash
docker-compose up --build
```

- Сервисы поднимутся в следующем порядке с учётом зависимости:
  - Сначала запускается и проверяется готовность базы данных PostgreSQL  
  - Затем запускается RabbitMQ  
  - После этого запускается API сервис и воркер  

3. После успешного запуска:  

- API будет доступен по адресу: [http://localhost:8000](http://localhost:8000)  
- RabbitMQ Management UI будет доступен по адресу: [http://localhost:15672](http://localhost:15672)  
  - Логин/пароль: guest / guest  

---

## Описание сервисов в `docker-compose.yml`

- **postgres**  
  Запускает PostgreSQL 15 версии.  
  Данные базы сохраняются в docker volume `postgres_data`, чтобы не терялись при перезапуске контейнера.  
  Порт 5432 проброшен наружу.

- **rabbitmq**  
  Запускает RabbitMQ с веб-менеджером.  
  Порты 5672 (AMQP) и 15672 (Management UI) проброшены наружу.

- **api**  
  Собирается из Dockerfile в папке `./api`.  
  Зависит от postgres и rabbitmq (ждёт их готовности).  
  Использует переменные окружения для подключения к базе и RabbitMQ.  
  Проброшен порт 8000 для доступа к FastAPI.

- **worker**  
  Собирается из Dockerfile в папке `./worker`.  
  Зависит от rabbitmq.  
  Работает в фоновом режиме, обрабатывая задачи из очередей.

---

## Переменные окружения

Для `api` и `worker` сервисов используются следующие переменные:

- `DB_HOST` — адрес базы данных (в нашем случае `postgres`, имя сервиса)  
- `DB_PORT` — порт PostgreSQL (5432)  
- `DB_USER` — пользователь базы данных (`postgres`)  
- `DB_PASS` — пароль пользователя базы (`1`)  
- `DB_NAME` — имя базы (`postgres`)  
- `RABBITMQ_URL` — URL подключения к RabbitMQ (`amqp://guest:guest@rabbitmq/`)  

---

## Проверка состояния

- Для проверки состояния базы данных и RabbitMQ настроены `healthcheck`, которые проверяют доступность сервисов.  
- Сервисы `api` и `worker` запускаются только после успешного прохождения healthcheck у зависимостей.

---

## Остановка и очистка

Для остановки всех контейнеров:

```bash
docker-compose down
```

Если хотите удалить также данные базы и образы:

```bash
docker-compose down -v --rmi all
```

---
